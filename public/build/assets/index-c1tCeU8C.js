import{K as E,r as k,j as e,L as y,$ as m}from"./app-Du9Va_cx.js";import{B as c}from"./button-CX_a-yqV.js";import{C as A}from"./checkbox-C9UOaRf3.js";import{L as F}from"./label-OTzwMRlW.js";import{S as h}from"./separator-C6OTpHmV.js";import{U as L}from"./user-cOFxYrvv.js";import{S as $}from"./shopping-cart-CtUJIbor.js";import{P as H}from"./package-C7JkNhan.js";import{B}from"./badge-check-CrrIVRrg.js";import{C as g}from"./check-BR_dNvJh.js";import{X as U}from"./x-BYrzKIXQ.js";import{H as K}from"./hourglass-BzUQUfbz.js";/* empty css            */import"./index-H4dqj7Kw.js";import"./index-C3_krGyj.js";import"./utils-CqiYvftL.js";import"./index-CyDQi5O5.js";import"./index-DfyjvsAc.js";import"./index-DqDuIf7A.js";import"./index-1W2oA-2t.js";import"./index-CUiXZJgQ.js";import"./index-DySSkRLM.js";import"./index-DUr3zujy.js";import"./createLucideIcon-Bp5WThYX.js";function xe({bundle:a,hasAccess:D,pendingInvoice:r,referralInfo:d}){var C;const{auth:N}=E().props,w=!!N.user,v=w&&((C=N.user)==null?void 0:C.phone_number),[u,z]=k.useState(!1),[S,P]=k.useState(!1),p=a.strikethrough_price-a.price,f=5e3,_=a.price+f;k.useEffect(()=>{const t=new URLSearchParams(window.location.search).get("ref");t?sessionStorage.setItem("referral_code",t):d.code&&sessionStorage.setItem("referral_code",d.code)},[d]);const R=async()=>{try{const t=await(await fetch("/csrf-token",{method:"GET",credentials:"same-origin"})).json(),l=document.querySelector('meta[name="csrf-token"]');return l&&(l.content=t.token),t.token}catch(s){throw console.error("Failed to refresh CSRF token:",s),s}},T=async s=>{if(s.preventDefault(),!v){alert("Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu."),window.location.href=route("profile.edit");return}if(!u){alert("Anda harus menyetujui syarat dan ketentuan!");return}P(!0);const t=async(l=0)=>{var o;const n={bundle_id:a.id,discount_amount:p,nett_amount:a.price,transaction_fee:f,total_amount:_};try{const i=(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.content,b=await fetch(route("invoice.store.bundle"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i||"",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(n)});if(b.status===419&&l<2)return console.log(`CSRF token expired, refreshing... (attempt ${l+1})`),await R(),t(l+1);const x=await b.json();if(b.ok&&x.success)if(x.payment_url)window.location.href=x.payment_url;else throw new Error("Payment URL not received");else throw new Error(x.message||"Gagal membuat invoice.")}catch(i){throw console.error("Payment error:",i),i}};try{await t()}catch(l){const n=l instanceof Error?l.message:"Terjadi kesalahan saat proses pembayaran.";alert(n),P(!1)}},j=s=>{const t=new Date,n=new Date(s).getTime()-t.getTime();if(n<=0)return{time:"Sudah kadaluarsa",status:"expired"};const o=Math.floor(n/(1e3*60*60)),i=Math.floor(n%(1e3*60*60)/(1e3*60));return o<1?{time:`${i} menit lagi`,status:"urgent"}:{time:`${o} jam ${i} menit lagi`,status:o<3?"urgent":"normal"}};if(!w){const s=window.location.href,t=route("login",{redirect:s});return e.jsxs("div",{className:"min-h-screen bg-[url('/assets/images/bg-product.png')] bg-cover bg-center bg-no-repeat",children:[e.jsx(y,{title:"Login Required"}),e.jsx("section",{className:"flex min-h-screen items-center justify-center px-4 py-12",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 rounded-2xl border bg-white/95 p-8 shadow-xl backdrop-blur-sm dark:bg-gray-800/95",children:[e.jsx("div",{className:"rounded-full bg-blue-100 p-6 dark:bg-blue-900/30",children:e.jsx(L,{size:48,className:"text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"mb-2 text-2xl font-bold",children:"Login Diperlukan"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Silakan login terlebih dahulu untuk membeli paket bundling",d.hasActive&&". Kode referral Anda akan tetap tersimpan"]})]}),e.jsxs("div",{className:"flex w-full gap-3",children:[e.jsx(c,{asChild:!0,className:"flex-1",size:"lg",children:e.jsx("a",{href:t,children:"Login"})}),e.jsx(c,{asChild:!0,variant:"outline",className:"flex-1",size:"lg",children:e.jsx(m,{href:route("register",d.code?{ref:d.code}:{}),children:"Daftar"})})]})]})})})]})}return v?e.jsxs("div",{className:"min-h-screen bg-[url('/assets/images/bg-product.png')] bg-cover bg-center bg-no-repeat",children:[e.jsx(y,{title:`Checkout - ${a.title}`}),e.jsxs("section",{className:"mx-auto w-full max-w-7xl px-4 py-12",children:[e.jsxs("div",{className:"mb-8 px-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(m,{href:"/bundle",className:"hover:text-orange-600",children:"Paket Bundling"}),e.jsx("span",{children:"/"}),e.jsx(m,{href:`/bundle/${a.slug}`,className:"hover:text-orange-600",children:a.title}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Checkout"})]}),e.jsx("h1",{className:"mt-8 text-3xl font-bold text-gray-900 md:text-4xl dark:text-white",children:"Checkout Paket Bundling"})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:r?"lg:col-span-3":"lg:col-span-2",children:e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white/95 shadow-xl backdrop-blur-sm dark:bg-gray-800/95",children:[e.jsx("div",{className:"border-b bg-gray-50/80 p-4 dark:bg-gray-900/80",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx($,{className:"h-5 w-5"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Detail Pesanan"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-24 w-32 flex-shrink-0 overflow-hidden rounded-lg",children:e.jsx("img",{src:a.thumbnail?`/storage/${a.thumbnail}`:"/assets/images/placeholder.png",alt:a.title,className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"mb-2 inline-block rounded-full bg-indigo-100 px-3 py-1 text-xs font-medium text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300",children:"Paket Bundling"}),e.jsx("h3",{className:"mb-2 text-lg font-semibold text-gray-900 dark:text-white",children:a.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(H,{size:16}),e.jsxs("span",{children:[a.bundle_items_count," Program"]})]})]})]}),e.jsx(h,{className:"my-6"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"mb-4 text-lg font-semibold text-gray-900 dark:text-white",children:["Isi Paket (",a.bundle_items_count," Program)"]}),e.jsx("div",{className:"space-y-3",children:a.bundle_items.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border p-3",children:[e.jsx("div",{className:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-orange-100 font-semibold text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:t+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate font-medium text-gray-900 dark:text-white",children:s.bundleable.title}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.bundleable_type.includes("Course")?"Kelas Online":s.bundleable_type.includes("Bootcamp")?"Bootcamp":"Webinar"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:s.price===0?"Gratis":`Rp ${s.price.toLocaleString("id-ID")}`})]},s.id))})]}),e.jsx(h,{className:"my-6"}),e.jsxs("div",{className:"rounded-lg bg-green-50 p-4 dark:bg-green-900/20",children:[e.jsxs("h4",{className:"mb-2 flex items-center gap-2 font-semibold text-green-800 dark:text-green-400",children:[e.jsx(B,{size:18}),"Keuntungan Paket Bundling"]}),e.jsxs("ul",{className:"space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2 text-sm text-green-700 dark:text-green-300",children:[e.jsx(g,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:["Hemat ",Math.round((a.strikethrough_price-a.price)/a.strikethrough_price*100),"% dari harga normal"]})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm text-green-700 dark:text-green-300",children:[e.jsx(g,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:["Akses ke ",a.bundle_items_count," program pembelajaran sekaligus"]})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm text-green-700 dark:text-green-300",children:[e.jsx(g,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Sertifikat untuk semua program yang diselesaikan"})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm text-green-700 dark:text-green-300",children:[e.jsx(g,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Akses selamanya ke semua materi pembelajaran"})]})]})]})]})]})}),e.jsx("div",{className:r?"lg:col-span-3":"lg:col-span-1",children:D?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-2xl border bg-white/95 p-6 text-center shadow-xl backdrop-blur-sm dark:bg-gray-800/95",children:[e.jsx("div",{className:"rounded-full bg-green-100 p-4 dark:bg-green-900/30",children:e.jsx(B,{size:48,className:"text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"mb-2 text-xl font-bold",children:"Sudah Memiliki Akses"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Anda sudah membeli paket bundling ini. Silakan lanjutkan belajar."})]}),e.jsx(c,{asChild:!0,className:"w-full",size:"lg",children:e.jsx(m,{href:route("profile.index"),children:"Lihat Dashboard"})})]}):r?e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white/95 shadow-xl backdrop-blur-sm dark:bg-gray-800/95",children:[e.jsx("div",{className:"border-b p-4 dark:bg-yellow-900/20",style:{backgroundColor:j(r.expires_at).status==="expired"&&r.status==="pending"?"#fee2e2":"rgba(254, 249, 195, 0.5)"},children:e.jsx("div",{className:"flex items-center gap-2",children:j(r.expires_at).status==="expired"&&r.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-5 w-5 text-red-600"}),e.jsx("h2",{className:"text-lg font-semibold text-red-700 dark:text-red-300",children:"Pembayaran Gagal"})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-5 w-5 text-yellow-600"}),e.jsx("h2",{className:"text-lg font-semibold text-yellow-900 dark:text-yellow-200",children:"Pembayaran Tertunda"})]})})}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"space-y-3 rounded-lg bg-gray-50 p-4 dark:bg-gray-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"No. Invoice"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:r.invoice_code})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Pembayaran"}),e.jsxs("span",{className:"text-xl font-bold text-orange-600",children:["Rp ",r.amount.toLocaleString("id-ID")]})]})]}),j(r.expires_at).status==="expired"&&r.status==="pending"?e.jsx("div",{className:"rounded-lg bg-red-50 p-4 dark:bg-red-900/20",children:e.jsxs("p",{className:"text-sm font-semibold text-red-700 dark:text-red-300",children:["Waktu pembayaran telah habis. Jika Anda sudah membayar atau butuh bantuan, silakan hubungi admin melaluiÂ ",e.jsx("a",{href:"https://wa.me/6289528514480",target:"_blank",rel:"noopener noreferrer",className:"font-bold text-orange-600 underline",children:"WhatsApp Admin"}),"."]})}):e.jsx(e.Fragment,{children:r.invoice_url?e.jsx(c,{asChild:!0,className:"w-full",size:"lg",children:e.jsx("a",{href:r.invoice_url,children:"Lanjutkan Pembayaran"})}):e.jsx("div",{className:"rounded-lg bg-red-50 p-4 dark:bg-red-900/20",children:e.jsx("p",{className:"text-sm font-semibold text-red-700 dark:text-red-300",children:"Link pembayaran tidak tersedia. Silakan refresh halaman untuk membuat pembayaran baru."})})}),e.jsx(c,{onClick:()=>window.location.reload(),variant:"outline",className:"w-full",size:"lg",children:"Cek Status Pembayaran"})]})]}):e.jsx("form",{onSubmit:T,children:e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white/95 shadow-xl backdrop-blur-sm dark:bg-gray-800/95",children:[e.jsx("div",{className:"border-b bg-gray-50/80 p-4 dark:bg-gray-900/80",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Ringkasan Pembayaran"})}),e.jsxs("div",{className:"space-y-4 p-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Harga Normal"}),e.jsxs("span",{className:"font-medium text-gray-500 line-through dark:text-gray-400",children:["Rp ",a.strikethrough_price.toLocaleString("id-ID")]})]}),p>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Diskon Bundle"}),e.jsxs("span",{className:"font-semibold text-red-600",children:["-Rp ",p.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Harga Bundle"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:["Rp ",a.price.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Biaya Transaksi"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:["Rp ",f.toLocaleString("id-ID")]})]}),e.jsx(h,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"Total Pembayaran"}),e.jsxs("span",{className:"text-2xl font-bold text-orange-600",children:["Rp ",_.toLocaleString("id-ID")]})]})]}),e.jsx(h,{}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(A,{id:"terms",checked:u,onCheckedChange:s=>z(s===!0),className:"mt-1"}),e.jsxs(F,{htmlFor:"terms",className:"text-sm leading-relaxed text-gray-600 dark:text-gray-400",children:["Saya menyetujui"," ",e.jsx("a",{href:"/terms-and-conditions",target:"_blank",rel:"noopener noreferrer",className:"font-medium text-orange-600 hover:underline",children:"syarat dan ketentuan"})," ","yang berlaku"]})]}),e.jsx(c,{className:"w-full",type:"submit",disabled:!u||S,size:"lg",children:S?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-b-2 border-white"}),"Memproses..."]}):"Bayar Sekarang"}),e.jsx("p",{className:"text-center text-xs text-gray-500 dark:text-gray-400",children:"Pembayaran aman dan terenkripsi"})]})]})})})]})]})]}):e.jsxs("div",{className:"min-h-screen bg-[url('/assets/images/bg-product.png')] bg-cover bg-center bg-no-repeat",children:[e.jsx(y,{title:"Checkout Paket Bundling"}),e.jsx("section",{className:"flex min-h-screen items-center justify-center px-4 py-12",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 rounded-2xl border bg-white/95 p-8 shadow-xl backdrop-blur-sm dark:bg-gray-800/95",children:[e.jsx("div",{className:"rounded-full bg-orange-100 p-6 dark:bg-orange-900/30",children:e.jsx(L,{size:48,className:"text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"mb-2 text-2xl font-bold",children:"Profil Belum Lengkap"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Harap lengkapi nomor telepon terlebih dahulu untuk melanjutkan pembelian"})]}),e.jsx(c,{asChild:!0,className:"w-full",size:"lg",children:e.jsx(m,{href:route("profile.edit",{redirect:window.location.href}),children:"Lengkapi Profil"})})]})})})]})}export{xe as default};
