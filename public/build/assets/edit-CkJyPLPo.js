import{r as g,m as H,j as e,L as J}from"./app-ByYcdn8-.js";import{I as v}from"./input-error-rF1mP89h.js";import{B as p}from"./button-CPZREZ85.js";import{C as X,a as Z,b as W,d as Y,c as ee}from"./card-Do1jSTYt.js";import{I as P}from"./input-ymxtCMBK.js";import{L as s}from"./label-BiNpUvbK.js";import{R as B,a as w}from"./radio-group-Do_WdE2a.js";import{S as ie,a as te,b as ae,c as oe,d as E}from"./select-Dk2YlUxi.js";import{A as ne}from"./admin-layout-C9Yj3y1t.js";import{E as y}from"./Editor-j1oLonfk.js";import{t as N}from"./index-CGepVr37.js";import{I as F}from"./image-plus-B58IsECg.js";import{T as se}from"./trash-Cq2JOjlb.js";/* empty css            */import"./utils-yhlFNeVc.js";import"./index-f2bHSftT.js";import"./index-aZYIIwcL.js";import"./index-COBmB5dm.js";import"./dropdown-menu-zBk9nvWv.js";import"./index-COXQ3JW7.js";import"./index-3l-GRrIT.js";import"./index-D8pI0x67.js";import"./index-BJj7pLJ7.js";import"./index-Bq7IRGSB.js";import"./index-mEeZU4fG.js";import"./floating-ui.react-dom-D0klkUwv.js";import"./index-Bxqy1k5G.js";import"./index-BVtXA4h5.js";import"./Combination-DxPlOGRw.js";import"./createLucideIcon-CBgsdzEp.js";import"./check-BqPaYJcy.js";import"./index-DeykmtS5.js";import"./index-BIwWzPDW.js";import"./chevron-down-BrXAnL3Y.js";import"./chevron-up-D8MCwfiq.js";import"./sonner-Crvv89QS.js";import"./breadcrumbs-BOgFbJZg.js";import"./index-DCdKzY7e.js";import"./x-CtPH-jjj.js";import"./tooltip-C5dhRPby.js";import"./avatar-BJjWWHY1.js";import"./use-initials-es9khXUz.js";import"./user-BEQVWNgZ.js";import"./breadcrumb-Dr2NNSwF.js";import"./chevron-right-9pzf-_22.js";import"./app-sidebar-header-DacTP_DM.js";import"./chevrons-up-down-B5pM4qxX.js";import"./user-check-DHqNee6Q.js";import"./users-BdS4tRoc.js";import"./monitor-play-D21AAB3B.js";import"./presentation-DjcuSZ49.js";import"./gift-BVnn4M7B.js";import"./banknote-D6Vc9hn1.js";import"./dollar-sign-CKO0hm42.js";import"./file-text-DLEzwTf1.js";import"./index-DJ0UPhDW.js";function mi({course:_,quiz:d,question:r}){var z;const R=g.useRef(null),h=g.useRef(null),x=g.useRef({}),[o,M]=g.useState((z=r.options)!=null&&z.length?r.options.map(i=>({id:i.id,option_text:i.option_text,option_image:null,option_image_preview:null,existing_option_image:i.option_image||null,existing_option_image_path:i.option_image||null,is_correct:i.is_correct})):[{option_text:"",option_image:null,option_image_preview:null,existing_option_image:null,existing_option_image_path:null,is_correct:!1},{option_text:"",option_image:null,option_image_preview:null,existing_option_image:null,existing_option_image_path:null,is_correct:!1}]),[k,G]=g.useState(r.type),[C,I]=g.useState(r.question_image||null),[T,S]=g.useState(!1),{data:f,setData:c,post:L,processing:q,errors:b}=H({_method:"PUT",question_text:r.question_text,question_image:null,remove_question_image:!1,type:r.type,explanation:r.explanation||"",options:o.map(i=>({option_text:i.option_text,option_image:i.option_image,remove_option_image:!i.existing_option_image&&!i.option_image_preview,is_correct:i.is_correct}))}),Q=[{title:"Kelas Online",href:route("courses.index")},{title:_.title,href:route("courses.show",{course:_.id})},{title:d.title,href:route("quizzes.show",{course:_.id,quiz:d.id})},{title:"Edit Pertanyaan",href:route("questions.edit",{course:_.id,quiz:d.id,question:r.id})}],j=2*1024*1024,O=i=>i.size>j?(N.error("Ukuran file tidak boleh melebihi 2MB!"),!1):!0,l=i=>{M(i),c("options",i.map(t=>({option_text:t.option_text,option_image:t.option_image,existing_option_image:t.existing_option_image_path,remove_option_image:!t.existing_option_image&&!t.option_image_preview,is_correct:t.is_correct})))},U=i=>{var a;const t=(a=i.target.files)==null?void 0:a[0];if(t){if(!O(t)){i.target.value="";return}c("question_image",t),S(!1),c("remove_question_image",!1);const n=new FileReader;n.onloadend=()=>{I(n.result)},n.readAsDataURL(t)}},$=()=>{c("question_image",null),c("remove_question_image",!0),S(!0),I(null),h.current&&(h.current.value="")},A=(i,t)=>{var n;const a=(n=t.target.files)==null?void 0:n[0];if(a){if(!O(a)){t.target.value="";return}const m=new FileReader;m.onloadend=()=>{const u=[...o];u[i].option_image=a,u[i].option_image_preview=m.result,u[i].existing_option_image=null,u[i].existing_option_image_path=null,l(u)},m.readAsDataURL(a)}},D=i=>{const t=[...o];t[i].option_image=null,t[i].option_image_preview=null,t[i].existing_option_image=null,t[i].existing_option_image_path=null,l(t),x.current[i]&&(x.current[i].value="")},K=i=>{if(i.preventDefault(),f.question_image&&f.question_image.size>j){N.error("Gambar pertanyaan melebihi ukuran maksimal 2MB!");return}for(let t=0;t<o.length;t++)if(o[t].option_image&&o[t].option_image.size>j){N.error(`Gambar opsi ${String.fromCharCode(65+t)} melebihi ukuran maksimal 2MB!`);return}L(route("questions.update",r.id),{preserveScroll:!0,onError:()=>{var t;return(t=R.current)==null?void 0:t.focus()}})};return e.jsxs(ne,{breadcrumbs:Q,children:[e.jsx(J,{title:"Edit Pertanyaan"}),e.jsx("div",{className:"px-4 py-4 md:px-6",children:e.jsxs(X,{children:[e.jsxs(Z,{children:[e.jsx(W,{children:"Edit Pertanyaan"}),e.jsxs(Y,{children:['Ubah pertanyaan untuk quiz "',d.title,'"']})]}),e.jsx(ee,{children:e.jsxs("form",{className:"space-y-4",onSubmit:K,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(s,{htmlFor:"question_text",children:"Pertanyaan"}),e.jsx(y,{apiKey:"f3upn9g1gl6r4m6ybrpbtceg23fxg21slzsgyhg0bui1qq4m",value:f.question_text,onEditorChange:i=>c("question_text",i),init:{plugins:["anchor","autolink","charmap","codesample","emoticons","image","link","lists","media","searchreplace","table","visualblocks","wordcount"],toolbar:"undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat",height:300}}),e.jsx(v,{message:b.question_text}),e.jsx(s,{htmlFor:"question_image",className:"mt-2",children:"Gambar Pertanyaan (Opsional, Max 2MB)"}),C&&!T?e.jsxs("div",{className:"",children:[e.jsx("img",{src:C,alt:"Preview",className:"h-48 rounded-lg border object-cover"}),e.jsx(p,{type:"button",variant:"destructive",size:"sm",className:"mt-2 w-full md:w-fit",onClick:$,children:"Hapus Gambar"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{ref:h,type:"file",accept:"image/*",onChange:U,className:"hidden",id:"question_image"}),e.jsxs(p,{type:"button",variant:"outline",onClick:()=>{var i;return(i=h.current)==null?void 0:i.click()},className:"w-full",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Upload Gambar (Max 2MB)"]})]}),e.jsx(v,{message:b.question_image}),e.jsx(s,{htmlFor:"explanation",className:"mt-2",children:"Pembahasan (Opsional)"}),e.jsx(y,{apiKey:"f3upn9g1gl6r4m6ybrpbtceg23fxg21slzsgyhg0bui1qq4m",value:f.explanation,onEditorChange:i=>c("explanation",i),init:{plugins:["anchor","autolink","charmap","codesample","emoticons","image","link","lists","media","searchreplace","table","visualblocks","wordcount"],toolbar:"undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat",height:200}}),e.jsx(v,{message:b.explanation}),e.jsx(s,{htmlFor:"type",className:"mt-2",children:"Tipe Pertanyaan"}),e.jsxs(ie,{value:k,onValueChange:i=>{var a,n;const t=i;G(t),c("type",t),l(t==="true_false"?[{option_text:"Benar",option_image:null,option_image_preview:null,existing_option_image:null,existing_option_image_path:null,is_correct:((a=o[0])==null?void 0:a.is_correct)??!1},{option_text:"Salah",option_image:null,option_image_preview:null,existing_option_image:null,existing_option_image_path:null,is_correct:((n=o[1])==null?void 0:n.is_correct)??!1}]:o.length>=2?o:[{option_text:"",option_image:null,option_image_preview:null,existing_option_image:null,existing_option_image_path:null,is_correct:!1},{option_text:"",option_image:null,option_image_preview:null,existing_option_image:null,existing_option_image_path:null,is_correct:!1}])},children:[e.jsx(te,{className:"w-full",children:e.jsx(ae,{placeholder:"Pilih tipe pertanyaan"})}),e.jsxs(oe,{children:[e.jsx(E,{value:"multiple_choice",children:"Pilihan Ganda"}),e.jsx(E,{value:"true_false",children:"Benar/Salah"})]})]})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Opsi Jawaban"}),e.jsx("p",{className:"mb-2 text-sm text-gray-500",children:"Setiap opsi harus memiliki teks atau gambar (atau keduanya)"}),e.jsx("div",{className:"mt-2 space-y-4",children:k==="true_false"?e.jsxs(B,{value:o.findIndex(i=>i.is_correct).toString(),onValueChange:i=>{const t=Number(i),a=o.map((n,m)=>({...n,is_correct:m===t}));l(a)},children:[e.jsxs("div",{className:"mb-1 flex items-center space-x-2",children:[e.jsx(w,{value:"0",id:"option-0"}),e.jsx(s,{htmlFor:"option-0",children:"Benar"})]}),e.jsxs("div",{className:"mb-1 flex items-center space-x-2",children:[e.jsx(w,{value:"1",id:"option-1"}),e.jsx(s,{htmlFor:"option-1",children:"Salah"})]})]}):e.jsxs(e.Fragment,{children:[o.map((i,t)=>e.jsxs("div",{className:`rounded-lg border-2 p-4 transition-colors ${i.is_correct?"border-green-500 bg-green-50":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs(s,{className:`text-base font-semibold ${i.is_correct?"text-green-700":""}`,children:["Opsi ",String.fromCharCode(65+t),i.is_correct&&e.jsx("span",{className:"ml-2 text-xs font-normal text-green-600",children:"(Jawaban Benar)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{value:o.findIndex(a=>a.is_correct).toString(),onValueChange:a=>{const n=Number(a),m=o.map((u,V)=>({...u,is_correct:V===n}));l(m)},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:t.toString(),id:`correct-${t}`}),e.jsx(s,{htmlFor:`correct-${t}`,className:"text-sm font-normal",children:"Jawaban Benar"})]})}),o.length>2&&e.jsx(p,{type:"button",variant:"destructive",size:"sm",onClick:()=>{const a=o.filter((n,m)=>m!==t);l(a)},children:e.jsx(se,{className:"h-4 w-4"})})]})]}),e.jsx(y,{apiKey:"f3upn9g1gl6r4m6ybrpbtceg23fxg21slzsgyhg0bui1qq4m",value:i.option_text,onEditorChange:a=>{const n=[...o];n[t].option_text=a,l(n)},init:{plugins:["anchor","autolink","charmap","codesample","emoticons","image","link","lists","media","searchreplace","table","visualblocks","wordcount"],toolbar:"undo redo | blocks fontsize | bold italic underline | link image table | align | numlist bullist | emoticons charmap | removeformat",height:150,menubar:!1,statusbar:!1}}),e.jsxs("div",{className:"mt-3",children:[e.jsxs(s,{className:"text-sm",children:["Gambar Opsi ",String.fromCharCode(65+t)," (Opsional, Max 2MB)"]}),i.option_image_preview||i.existing_option_image?e.jsxs("div",{className:"",children:[e.jsx("img",{src:i.option_image_preview||i.existing_option_image||"",alt:"Preview",className:"h-32 rounded border object-cover"}),e.jsx(p,{type:"button",variant:"destructive",size:"sm",className:"mt-2 w-full text-xs md:w-fit",onClick:()=>D(t),children:"Hapus Gambar"})]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{ref:a=>{x.current[t]=a},type:"file",accept:"image/*",onChange:a=>A(t,a),className:"hidden",id:`option_image_${t}`}),e.jsxs(p,{type:"button",variant:"outline",size:"sm",onClick:()=>{var a;return(a=x.current[t])==null?void 0:a.click()},className:"mt-2 w-full",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Upload Gambar (Max 2MB)"]})]})]})]},i.id??t)),e.jsx(p,{type:"button",variant:"secondary",size:"sm",className:"w-full",onClick:()=>l([...o,{option_text:"",option_image:null,option_image_preview:null,existing_option_image:null,existing_option_image_path:null,is_correct:!1}]),children:"+ Tambah Opsi"})]})}),e.jsx(v,{message:b.options})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>window.history.back(),className:"hover:cursor-pointer",children:"Batal"}),e.jsx(p,{disabled:q,type:"submit",className:"hover:cursor-pointer",children:q?"Menyimpan...":"Simpan Perubahan"})]})]})})]})})]})}export{mi as default};
